name: "Deploy: Production"
run-name: ğŸ“Œ  <${{ inputs.deploy_to }}> æœ¬ç•ªç’°å¢ƒã¸ ${{ github.ref_name }} ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ ğŸš€

on:
  # æ‰‹å‹•ãƒˆãƒªã‚¬ãƒ¼
  workflow_dispatch:
    inputs:
      deploy_to:
        type: choice
        description: Deploy to
        default: all
        options:
          - GCP cloud run
          - AWS lambda
          - AWS lightsail
          - WIP- AWS ECS
      approval:
        description: 'type deploy/production'
        required: true

# æœ¬ç•ªãƒªãƒªãƒ¼ã‚¹ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’åŒæ™‚ã«å®Ÿè¡Œã§ããªã„ã‚ˆã†ã«ã‚³ãƒ³ã‚«ãƒ¬ãƒ³ã‚·ãƒ¼ã‚’ä½¿ç”¨
concurrency: ${{ github.workflow }}

jobs:
  check-input:
    runs-on: ubuntu-latest
    steps:
      - if: ${{ github.event.inputs.approval != 'deploy/production' }}
        run: echo '::error ::`approval` ã« `deploy/production` ã¨å…¥åŠ›ã—ã¦ãã ã•ã„'; exit 1
      - if: ${{ github.ref_name != 'main' }}
        run: echo '::error ::`branch` ã¯ `main` ã‚’æŒ‡å®šã—ã¦ãã ã•ã„'; exit 1
